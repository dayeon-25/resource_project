<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="/css/common.css">
    <link rel="stylesheet" href="/css/result.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="result">
{{>layout/header}}
<div class="container">
    <div class="title_container">
        <p id="title">ìˆœí™˜ ê³¨ì¬ í’ˆì§ˆ ë¶„ì„</p>
        <p class="subtitle">AI ê¸°ë°˜ ë¶ˆìˆœë¬¼ ê²€ì¶œ ë° í’ˆì§ˆ </p>
    </div>
    <div class="distinction_container">
        <div class="distinction_container_left">
            <h2 id="distinction_label">ë¶„ì„ ì™„ë£Œ - í’ˆì§ˆ {{result.suitable}}</h2>
            <p style="font-size:0.8rem; margin-bottom:1rem;">ì´ 3ê°œì˜ ë¶ˆìˆœë¬¼ì´ ê²€ì¶œë˜ì—ˆìŠµë‹ˆë‹¤. ì „ì²´ ë¹„ìœ¨ {{result.total}}%</p>
            <div class="button_group">
                <button id="view_detail_button">ìƒì„¸ ë¶„ì„ ë³´ê¸°</button>
                <button id="new_analyze_button">ìƒˆë¡œìš´ ë¶„ì„</button>
            </div>
        </div>
        <button id="distinction_mark">{{result.suitable}}</button>
    </div>
    <div class="result_title">
        <h2>ë¶ˆìˆœë¬¼ ê²€ì¶œ ê²°ê³¼</h2>
        <hr style="border: 0.2rem solid black; margin:1rem 0;">
    </div>
    <div class="result_container">
        <div class="result_left">
            <h4>ì„ íƒí•œ ì´ë¯¸ì§€</h4>
            <img src="{{result.origImage}}" alt="ì›ë³¸ ì´ë¯¸ì§€">
            <div class="result_recap">
                <div id="recap_number">
                    <h3>ì´ ë¶ˆìˆœë¬¼ ê°œìˆ˜</h3>
                    <p class="recap_text" style="font-size:1.5rem;"><strong>{{result.count}}</strong></p>
                    <p style="font-size:0.7rem;">ê²€ì¶œëœ ì „ì²´ ë¶ˆìˆœë¬¼</p>
                </div>
                <div id="recap_ratio">
                    <h3>ì „ì²´ ë¶ˆìˆœë¬¼ ë¹„ìœ¨</h3>
                    <p class="recap_text" style="font-size:1.5rem;"><strong>{{result.total}}%</strong></p>
                    <p style="font-size:0.7rem;">ì „ì²´ ê³¨ì¬ ëŒ€ë¹„</p>
                </div>
            </div>
            <div class="barchart_title">
                <h4>ê²€ì¶œ ë¶ˆìˆœë¬¼ ë¹„ìœ¨ ë¹„êµ</h4><p style="font-size:0.8rem;">AI ê¸°ë°˜ ë¶ˆìˆœë¬¼ ê²€ì¶œ ë° í’ˆì§ˆ ê¸°ì¤€ ì í•©ì„± íŒë‹¨</p>
            </div>
            <div class="bar_container">
                <canvas id="bar-chart"></canvas>
            </div>
        </div>

        <div class="result_right">
            <h4>ì´ë¯¸ì§€ ë¶„ì„ ê²°ê³¼</h4>
            <img src="{{result.rcnnResult}}" alt="ê²°ê³¼ ì´ë¯¸ì§€">
            <button id="view_transaction_button">ì´ë¯¸ì§€ ì²˜ë¦¬ ê³¼ì • ìì„¸íˆ ë³´ê¸°</button>
            <div class="ratio_container">
                <div class="ratio_box">
                    <p><span class="color_mark" style="background:#3b4d08;"></span>íë¹„ë‹({{result.vinyl}}%)</p>
                </div>
                <div class="ratio_box">
                    <p><span class="color_mark" style="background:#303e51;"></span>íí”Œë¼ìŠ¤í‹±({{result.plastic}}%)</p>
                </div>
                <div class="ratio_box">
                    <p><span class="color_mark" style="background:#be563d;"></span>íëª©ì¬({{result.wood}}%)</p>
                </div>
            </div>
            <div class="donut_title">
                <h4>ë¶ˆìˆœë¬¼ êµ¬ì„± ë¹„ìœ¨</h4>
                <p style="font-size:0.8rem;">ê²€ì¶œëœ ë¶ˆìˆœë¬¼ ì¤‘ ê° ì¢…ë¥˜ê°€ ì°¨ì§€í•˜ëŠ” ë¹„ìœ¨</p>
            </div>
            <div class="donut_container">
                <canvas id="donut-chart"></canvas>
            </div>
        </div>
    </div>
    <div class="recommendation">
        <h3 style="margin-bottom:0.5rem;">í’ˆì§ˆ ê´€ë¦¬ ê°œì„  ì‚¬í•­</h3>
        <p id="recommendation_text"></p>
    </div>
</div>

<div class="modal" id="modal">
    <div class="modal-container">
        <span class="modal-close" id="modal-close">&times;</span>
        <p class="analysis-date">ë¶„ì„ì¼ì {{result.analysisDate}}</p>
        <hr class="modal-line">
        <div class="analysis-container">
            <div class="analysis-content1">
                <div class="content1-left">
                    <h1 class="modal-title">ìˆœí™˜ê³¨ì¬ í’ˆì§ˆ ë¶„ì„ ë¦¬í¬íŠ¸</h1>
                    <p style="font-size:0.7rem;">AIê¸°ë°˜ ë¶ˆìˆœë¬¼ ê²€ì¶œ ë° í’ˆì§ˆ ê¸°ì¤€ ì í•©ì„± íŒë‹¨ ê²°ê³¼</p>

                    <div class="analysis-result-title">
                        <h2>ë¶„ì„ ê²°ê³¼<span>R-CNNì„ ë©”ì¸ìœ¼ë¡œ,PCA ìƒ‰ìƒ ë¶„ì„ì€ ë³´ì¡° ì§€í‘œë¡œ í™œìš©</span></h2>
                        <p>ê¸°ì¤€ : KS F2576</p>
                    </div>
                    <hr class="modal-line">

                </div>
                <div class="content1-right">
                    <p>ì…ë ¥ì´ë¯¸ì§€</p>
                    <img src="{{result.origImage}}" alt="ì›ë³¸ ì´ë¯¸ì§€" class="modal-img">
                </div>
            </div>
            <div class="analysis-content2">
                <div class="analysis-box">
                    <h2 class="analysis-title">R-CNN ê°ì²´ ê²€ì¶œ ë¶„ì„<span>ë¶ˆìˆœë¬¼ ê°ì²´ ê²€ì¶œ ê³¼ì •</span></h2>
                    <hr class="modal-line">
                    <img src="{{result.rcnnResult}}" alt="rcnn ì´ë¯¸ì§€" class="modal-img">
                    <p class="analysis-description">
                        <strong>R-CNN (Region-based Convolutional Neural Network)</strong>ì€
                        ì´ë¯¸ì§€ì—ì„œ <span class="highlight">ê°ì²´ê°€ ìˆì„ ë²•í•œ ì˜ì—­(Region Proposal)</span>ì„ ì¶”ì¶œí•˜ê³ ,
                        ê° ì˜ì—­ì„ CNNìœ¼ë¡œ ë¶„ë¥˜í•˜ì—¬ ê°ì²´ë¥¼ ì¸ì‹í•˜ëŠ” <strong>ë”¥ëŸ¬ë‹ ê¸°ë°˜ ê°ì²´ íƒì§€ ê¸°ë²•</strong>ì…ë‹ˆë‹¤.<br><br>
                        í•™ìŠµëœ ëª¨ë¸ì„ ì´ìš©í•´ ì´ë¯¸ì§€ ë‚´ <span class="highlight">ë¶ˆìˆœë¬¼ ì˜ì—­</span>ì„ ê²€ì¶œí•˜ê³ ,
                        ì „ì²´ í”½ì…€ ëŒ€ë¹„ ë¶ˆìˆœë¬¼ í”½ì…€ ë¹„ìœ¨ì„ ê³„ì‚°í•˜ì—¬ í’ˆì§ˆ ì í•© ì—¬ë¶€ë¥¼ í‰ê°€í•©ë‹ˆë‹¤.<br>
                        ğŸ“Š ì „ì²´ ë¶ˆìˆœë¬¼ ë¹„ìœ¨ : <strong>{{result.total}}%</strong>
                    </p>

                </div>
                <div class="analysis-box">
                    <h2 class="analysis-title">OpenCV ë¶„ì„<span>ìƒ‰ìƒ ê¸°ë°˜ ë¶ˆìˆœë¬¼ ê²€ì¶œ ê³¼ì •</span></h2>
                    <hr class="modal-line">
                    <img src="{{result.opencvResult}}" alt="opencv ì´ë¯¸ì§€" class="modal-img">
                    <p class="analysis-description">
                        <strong>OpenCV ìƒ‰ìƒ ë¶„ì„</strong>ì€ ì´ë¯¸ì§€ì˜ ìƒ‰ìƒ ì •ë³´ë¥¼ <span class="highlight">RGB</span> í˜•íƒœë¡œ ë³€í™˜í•œ ë’¤,
                        íŠ¹ì • ìƒ‰ìƒ ë²”ìœ„ì— í¬í•¨ë˜ì§€ ì•ŠëŠ” ì˜ì—­ì„ <strong>ë¶ˆìˆœë¬¼ë¡œ íƒì§€</strong>í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.<br><br>
                        ë¶ˆìˆœë¬¼ì— í•´ë‹¹í•˜ëŠ” ìµœì  ìƒ‰ìƒ ë²”ìœ„ (<strong>x, x, x</strong>)ë¥¼ ì¶”ì¶œí•˜ê³ 
                        <span class="highlight">ë¶ˆìˆœë¬¼ì€ í°ìƒ‰</span>, ë‚˜ë¨¸ì§€ëŠ” ê²€ì€ìƒ‰ìœ¼ë¡œ ì²˜ë¦¬í•˜ì—¬ ì‹œê°ì ìœ¼ë¡œ êµ¬ë¶„í–ˆìŠµë‹ˆë‹¤.
                    </p>


                </div>
                <div class="analysis-box">
                    <h2 class="analysis-title">PCA ë¶„ì„<span>ì´ìƒì¹˜ ê²€ì¶œ ê³¼ì •</span></h2>
                    <hr class="modal-line">
                    <img src="{{result.pca}}" alt="pca ì´ë¯¸ì§€" class="modal-img">
                    <p class="analysis-description">
                        <strong>PCA (Principal Component Analysis)</strong>ëŠ” ë°ì´í„°ë¥¼ ì£¼ìš” íŠ¹ì§•(ì£¼ì„±ë¶„)ìœ¼ë¡œ ì••ì¶•í•˜ì—¬
                        ë‹¤ë¥¸ ì˜ì—­ê³¼ í†µê³„ì ìœ¼ë¡œ ë‹¤ë¥¸ <span class="highlight">ì´ìƒì¹˜</span>ë¥¼ ì°¾ì•„ë‚´ëŠ”
                        <strong>í†µê³„ì  ì°¨ì› ì¶•ì†Œ ê¸°ë²•</strong>ì…ë‹ˆë‹¤.<br><br>
                        ì°¨ì› ì¶•ì†Œ í›„ <span class="highlight">ì‚°ì ë„ ê·¸ë˜í”„</span>ë¡œ ì‹œê°í™”í•˜ì—¬
                        ë¶ˆìˆœë¬¼ì˜ ë¶„í¬ íŒ¨í„´ê³¼ í’ˆì§ˆ íŠ¹ì„±ì„ í•œëˆˆì— í™•ì¸í•  ìˆ˜ ìˆë„ë¡ êµ¬ì„±í–ˆìŠµë‹ˆë‹¤.
                    </p>


                </div>
            </div>
            <div class="analysis-content3">
                <h2>í†µê³„ ë¶„ì„</h2>
                <div class="analysis-chart-container">
                    <div class="chart-box">
                        <h4>ì¢…ë¥˜ë³„ ë¶ˆìˆœë¬¼ êµ¬ì„± ë¹„ìœ¨</h4>
                        <div class="chart-size">
                            <canvas id="modal-donut-chart"></canvas>
                        </div>
                    </div>
                    <div class="chart-box">
                        <h4>ë¶ˆìˆœë¬¼ ê²€ì¶œëŸ‰ ë¹„êµ</h4>
                        <div class="chart-size">
                            <canvas id="modal-bar-chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



<script>

    const newAnalyzeButton = document.getElementById("new_analyze_button");
    newAnalyzeButton.addEventListener("click", function () {
        window.location.href=`/analyze`;
    });

    const distinctionLabel = document.getElementById("distinction_label");
    distinctionLabel.style.color = ("{{result.suitable}}" === "ì í•©") ? "#2f9055" : "#b52b09";


    const distinctMark = document.getElementById('distinction_mark');
    distinctMark.style.backgroundColor = ("{{result.suitable}}" === "ì í•©") ? "#2f9055" : "#b52b09";

    const total = Number("{{result.total}}");
    const recapTexts = document.querySelectorAll('.recap_text');
    recapTexts.forEach(p => {
        if(total>1){
            p.style.color = "#b52b09";
            } else {
            p.style.color = "#2f9055";
        }
    });


    const recommendationText = document.getElementById('recommendation_text');

    if(total > 1){
        recommendationText.innerHTML = `ê²€ì¶œëœ ë¶ˆìˆœë¬¼ ë¹„ìœ¨(${total}%)ì´ KSê¸°ì¤€(1.0% ì´í•˜)ì„ ì´ˆê³¼í•©ë‹ˆë‹¤.<br>
    ì¶”ê°€ ì„ ë³„ ê³¼ì •ì„ í†µí•´ ë¶ˆìˆœë¬¼ ì œê±° í›„ ì¬ê²€ì‚¬ë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤.`;
    }else{
        recommendationText.innerHTML = `ê²€ì¶œëœ ë¶ˆìˆœë¬¼ ë¹„ìœ¨(${total}%)ì´ KSê¸°ì¤€(1.0% ì´í•˜)ì„ ë§Œì¡±í•©ë‹ˆë‹¤.<br>
    ì¶”ê°€ ì„ ë³„ ê³¼ì •ì—†ì´ ì§„í–‰í•˜ì…”ë„ ì¢‹ìŠµë‹ˆë‹¤.`;
    }

    const ratioVinyl={{result.vinyl}}/({{result.vinyl}}+{{result.plastic}}+{{result.wood}})*100;
    const ratioPlastic={{result.plastic}}/({{result.vinyl}}+{{result.plastic}}+{{result.wood}})*100;
    const ratioWood={{result.wood}}/({{result.vinyl}}+{{result.plastic}}+{{result.wood}})*100;

     new Chart(document.getElementById("bar-chart").getContext('2d'), {
        type: 'bar',
        data: {
            labels: ["íë¹„ë‹","íí”Œë¼ìŠ¤í‹±","íëª©ì¬"],
            datasets: [
            {
                label: "ì „ì²´ ì´ë¯¸ì§€ ë¶ˆìˆœë¬¼ í‰ê·  ê²€ì¶œëŸ‰",
                data: [{{result.avgVinyl}},{{result.avgPlastic}},{{result.avgWood}}],
                backgroundColor: '#f1512e'
            },
            {
                label: "í•´ë‹¹ ì´ë¯¸ì§€ ë¶ˆìˆœë¬¼ ê²€ì¶œëŸ‰",
                data: [{{result.vinyl}},{{result.plastic}},{{result.wood}}],
                backgroundColor: 'black'
            }
            ]
        },
        options: {
            responsive: true,       // ì°¨íŠ¸ê°€ ë¶€ëª¨ ì»¨í…Œì´ë„ˆ í¬ê¸°ì— ë§ì¶° ìë™ìœ¼ë¡œ í¬ê¸° ì¡°ì •ë¨
            maintainAspectRatio: false, // trueë©´ aspect-ratio ê³ ì •, falseë©´ ë¶€ëª¨ í¬ê¸°ì— ë§ì¶¤
            plugins: {
                legend: {
           display: true,           // ë²”ë¡€ í‘œì‹œ ì—¬ë¶€
           position: 'top',       // ìœ„ì¹˜ (top, bottom, left, right)
           align: 'end',          // ì„¸ë¡œ ì •ë ¬ (start, center, end)
           labels: {
           boxWidth: 12,          // ë²”ë¡€ ìƒ‰ìƒ ë°•ìŠ¤ ë„ˆë¹„ (ì‘ê²Œ)
           boxHeight: 12,         // ë²”ë¡€ ìƒ‰ìƒ ë°•ìŠ¤ ë†’ì´ (ì‘ê²Œ)
           usePointStyle: false,  // trueë©´ ì›í˜•, falseë©´ ì‚¬ê°í˜•
           pointStyle: 'rect',    // ë°•ìŠ¤ ëª¨ì–‘ ì§€ì • ('circle', 'rect', 'triangle' ë“±)
           padding: 10,           // í•­ëª© ê°„ ê°„ê²©
           color: '#000',         // ê¸€ììƒ‰
                    }
                }
            }
       }
    });



    new Chart(document.getElementById("donut-chart").getContext('2d'), {
       type: 'doughnut',
       data: {
           labels: ["íë¹„ë‹","íí”Œë¼ìŠ¤í‹±","íëª©ì¬"],
           datasets: [{
               data: [ratioVinyl, ratioPlastic, ratioWood],
               backgroundColor: ['#3b4d08','#303e51','#be563d']
           }]
       },
       options: {
           responsive: true,       // ì°¨íŠ¸ê°€ ë¶€ëª¨ ì»¨í…Œì´ë„ˆ í¬ê¸°ì— ë§ì¶° ìë™ìœ¼ë¡œ í¬ê¸° ì¡°ì •ë¨
           maintainAspectRatio: false, // trueë©´ aspect-ratio ê³ ì •, falseë©´ ë¶€ëª¨ í¬ê¸°ì— ë§ì¶¤
           plugins: {
               legend: {
           display: true,           // ë²”ë¡€ í‘œì‹œ ì—¬ë¶€
           position: 'right',       // ìœ„ì¹˜ (top, bottom, left, right)
           align: 'start',          // ì„¸ë¡œ ì •ë ¬ (start, center, end)
           labels: {
           boxWidth: 12,          // ë²”ë¡€ ìƒ‰ìƒ ë°•ìŠ¤ ë„ˆë¹„ (ì‘ê²Œ)
           boxHeight: 12,         // ë²”ë¡€ ìƒ‰ìƒ ë°•ìŠ¤ ë†’ì´ (ì‘ê²Œ)
           usePointStyle: false,  // trueë©´ ì›í˜•, falseë©´ ì‚¬ê°í˜•
           pointStyle: 'rect',    // ë°•ìŠ¤ ëª¨ì–‘ ì§€ì • ('circle', 'rect', 'triangle' ë“±)
           padding: 10,           // í•­ëª© ê°„ ê°„ê²©
           color: '#000',         // ê¸€ììƒ‰

      }
    }
           }
       }
   });

    new Chart(document.getElementById("modal-donut-chart").getContext('2d'), {
       type: 'doughnut',
       data: {
           labels: ["íë¹„ë‹","íí”Œë¼ìŠ¤í‹±","íëª©ì¬"],
           datasets: [{
               data: [ratioVinyl, ratioPlastic, ratioWood],
               backgroundColor: ['#3b4d08','#303e51','#be563d']
           }]
       },
       options: {
           responsive: true,       // ì°¨íŠ¸ê°€ ë¶€ëª¨ ì»¨í…Œì´ë„ˆ í¬ê¸°ì— ë§ì¶° ìë™ìœ¼ë¡œ í¬ê¸° ì¡°ì •ë¨
           maintainAspectRatio: false, // trueë©´ aspect-ratio ê³ ì •, falseë©´ ë¶€ëª¨ í¬ê¸°ì— ë§ì¶¤
           plugins: {
               legend: {
           display: true,           // ë²”ë¡€ í‘œì‹œ ì—¬ë¶€
           position: 'right',       // ìœ„ì¹˜ (top, bottom, left, right)
           align: 'start',          // ì„¸ë¡œ ì •ë ¬ (start, center, end)
           labels: {
           boxWidth: 12,          // ë²”ë¡€ ìƒ‰ìƒ ë°•ìŠ¤ ë„ˆë¹„ (ì‘ê²Œ)
           boxHeight: 12,         // ë²”ë¡€ ìƒ‰ìƒ ë°•ìŠ¤ ë†’ì´ (ì‘ê²Œ)
           usePointStyle: false,  // trueë©´ ì›í˜•, falseë©´ ì‚¬ê°í˜•
           pointStyle: 'rect',    // ë°•ìŠ¤ ëª¨ì–‘ ì§€ì • ('circle', 'rect', 'triangle' ë“±)
           padding: 10,           // í•­ëª© ê°„ ê°„ê²©
           color: '#000',         // ê¸€ììƒ‰

      }
    }
           }
       }
   });

    new Chart(document.getElementById("modal-bar-chart").getContext('2d'), {
        type: 'bar',
        data: {
            labels: ["íë¹„ë‹","íí”Œë¼ìŠ¤í‹±","íëª©ì¬"],
            datasets: [
            {
                label: "ì „ì²´ ì´ë¯¸ì§€ ë¶ˆìˆœë¬¼ í‰ê·  ê²€ì¶œëŸ‰",
                data: [{{result.avgVinyl}},{{result.avgPlastic}},{{result.avgWood}}],
                backgroundColor: '#f1512e'
            },
            {
                label: "í•´ë‹¹ ì´ë¯¸ì§€ ë¶ˆìˆœë¬¼ ê²€ì¶œëŸ‰",
                data: [{{result.vinyl}},{{result.plastic}},{{result.wood}}],
                backgroundColor: 'black'
            }
            ]
        },
        options: {
            responsive: true,       // ì°¨íŠ¸ê°€ ë¶€ëª¨ ì»¨í…Œì´ë„ˆ í¬ê¸°ì— ë§ì¶° ìë™ìœ¼ë¡œ í¬ê¸° ì¡°ì •ë¨
            maintainAspectRatio: false, // trueë©´ aspect-ratio ê³ ì •, falseë©´ ë¶€ëª¨ í¬ê¸°ì— ë§ì¶¤
            plugins: {
                legend: {
           display: true,           // ë²”ë¡€ í‘œì‹œ ì—¬ë¶€
           position: 'top',       // ìœ„ì¹˜ (top, bottom, left, right)
           align: 'end',          // ì„¸ë¡œ ì •ë ¬ (start, center, end)
           labels: {
           boxWidth: 12,          // ë²”ë¡€ ìƒ‰ìƒ ë°•ìŠ¤ ë„ˆë¹„ (ì‘ê²Œ)
           boxHeight: 12,         // ë²”ë¡€ ìƒ‰ìƒ ë°•ìŠ¤ ë†’ì´ (ì‘ê²Œ)
           usePointStyle: false,  // trueë©´ ì›í˜•, falseë©´ ì‚¬ê°í˜•
           pointStyle: 'rect',    // ë°•ìŠ¤ ëª¨ì–‘ ì§€ì • ('circle', 'rect', 'triangle' ë“±)
           padding: 10,           // í•­ëª© ê°„ ê°„ê²©
           color: '#000',         // ê¸€ììƒ‰
      }
    }
            }
        }
    });


    const modal = document.getElementById('modal');
    const viewDetailButton = document.getElementById('view_detail_button');

    viewDetailButton.addEventListener('click', function() {
        modal.style.display = 'block';
    });

    document.getElementById("modal-close").addEventListener("click",function (){
        modal.style.display="none";
    });

    window.addEventListener("click",function (e){
        if(e.target.id==='modal'){
            modal.style.display="none";
        }
    });



</script>
</body>
</html>